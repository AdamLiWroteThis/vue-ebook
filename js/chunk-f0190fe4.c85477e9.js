(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f0190fe4"],{"0957":function(t,e,i){},"2d27":function(t,e,i){"use strict";var n=i("0957"),a=i.n(n);a.a},3111:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"bottom-wrapper",class:{"hide-play":!t.showPlay}},[t.showPlay?i("div",{staticClass:"bottom-playing-wrapper",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.onPlayingCardClick(e)}}},[i("div",{staticClass:"bottom-playing-left"},[i("div",{staticClass:"icon-play-wrapper",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.togglePlay(e)}}},[t.isPlaying?i("span",{staticClass:"icon-play_pause"}):i("span",{staticClass:"icon-play_go"})])]),i("div",{staticClass:"bottom-playing-right"},[i("div",{staticClass:"bottom-playing-chapter-text"},[i("span",{staticClass:"chapter-label"},[t._v(t._s(t.chapter?t.chapter.label:""))]),t.currentSectionIndex&&t.currentSectionTotal?i("span",{staticClass:"bottom-playing-page-text"},[t._v("( "+t._s(t.currentSectionIndex)+" / "+t._s(t.currentSectionTotal)+" )")]):t._e()]),i("div",{staticClass:"bottom-playing-page-text"},[t._v(t._s(t.playInfo?t.playInfo.currentMinute:"00")+":"+t._s(t.playInfo?t.playInfo.currentSecond:"00")+" / "+t._s(t.playInfo?t.playInfo.totalMinute:"00")+":"+t._s(t.playInfo?t.playInfo.totalSecond:"00"))])])]):t._e(),i("div",{staticClass:"bottom-btn-wrapper"},[i("span",{staticClass:"bottom-btn-text"},[t._v(t._s(t.$t("detail.addOrRemoveShelf")))])])])},a=[],s=(i("a9e3"),{props:{chapter:Object,currentSectionIndex:Number,currentSectionTotal:Number,showPlay:Boolean,isPlaying:Boolean,playInfo:Object},methods:{togglePlay:function(){this.$parent.togglePlay()},onPlayingCardClick:function(){this.$emit("onPlayingCardClick")}}}),o=s,r=(i("db59"),i("2877")),c=Object(r["a"])(o,n,a,!1,null,"07a440f0",null);e["a"]=c.exports},"36ff":function(t,e,i){"use strict";var n=i("76d3"),a=i.n(n);a.a},"4d646":function(t,e,i){},5076:function(t,e,i){},"5b70":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("transition",{attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],staticClass:"book-speak-mask-wrapper",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.hide(e)}}},[i("transition",{attrs:{name:"popup-slide-up"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.speakCardVisible,expression:"speakCardVisible"}],staticClass:"book-speak-mask-card-wrapper",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.hide(e)}}},[i("div",{staticClass:"pulldown-icon-wrapper",on:{click:t.hide}},[i("span",{staticClass:"icon-pull_down"})]),i("div",{staticClass:"card-title-wrapper"},[i("div",{staticClass:"icon-speak-wrapper"},[i("span",{staticClass:"icon-speak"})]),i("div",{staticClass:"speak-title-wrapper"},[i("span",{staticClass:"speak-title"},[t._v(t._s(t.$t("speak.voice")))])]),i("div",{staticClass:"read-fulltext-wrapper"},[i("span",{staticClass:"read-fulltext"},[t._v(t._s(t.$t("speak.read")))])])]),i("div",{staticClass:"card-section-title-wrapper"},[i("div",{staticClass:"card-section-title-text"},[t._v(t._s(t.title))]),t.currentSectionIndex?i("div",{staticClass:"card-section-sub-title-text"},[t._v(t._s(t.currentSectionIndex)+" / "+t._s(t.currentSectionTotal)+" ")]):t._e()]),i("div",{staticClass:"setting-progress"},[i("div",{staticClass:"progress-wrapper"},[i("input",{ref:"progress",staticClass:"progress",attrs:{type:"range",max:"100",min:"0",step:"1"},domProps:{value:t.progress},on:{change:function(e){return t.onProgressChange(e.target.value)},input:function(e){return t.onProgressInput(e.target.value)}}})]),i("div",{staticClass:"progress-text"},[i("div",{staticClass:"progress-text-current"},[t._v(t._s(t.playInfo?t.playInfo.currentMinute:"00")+":"+t._s(t.playInfo?t.playInfo.currentSecond:"00")+" ")]),i("div",{staticClass:"progress-text-left"},[t._v("-"+t._s(t.playInfo?t.playInfo.leftMinute:"00")+":"+t._s(t.playInfo?t.playInfo.leftSecond:"00")+" ")])])]),i("div",{staticClass:"playing-wrapper"},[i("div",{staticClass:"icon-settings-wrapper"},[i("span",{staticClass:"icon-settings"}),i("div",{staticClass:"settings-text"},[t._v(t._s(t.$t("speak.settings")))])]),i("span",{staticClass:"icon-play_backward",class:{"not-use":t.currentSectionIndex<=1},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.prev(e)}}}),i("div",{staticClass:"icon-play-wrapper",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.togglePlay(e)}}},[t.isPlaying?i("span",{staticClass:"icon-play_pause"}):i("span",{staticClass:"icon-play_go"})]),i("span",{staticClass:"icon-play_forward",class:{"not-use":t.currentSectionIndex>=t.currentSectionTotal},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.next(e)}}}),i("div",{staticClass:"icon-clock-wrapper"},[i("span",{staticClass:"icon-clock"}),i("div",{staticClass:"clock-text"},[t._v(t._s(t.$t("speak.timing")))])])]),i("div",{staticClass:"read-apply-wrapper"},[t._v(" "+t._s(t.$t("speak.apply"))+" ")]),i("div",{staticClass:"read-title-wrapper"},[i("span",{staticClass:"line"}),i("div",{staticClass:"read-title-text"},[t._v(t._s(t.$t("speak.current")))]),i("span",{staticClass:"line"})]),i("div",{ref:"bookWrapper",staticClass:"book-wrapper"},[i("div",{attrs:{id:"book-read"}})])])])],1)])},a=[],s=(i("99af"),i("a9e3"),i("d3b7"),i("ac1f"),i("25f0"),i("5319"),i("fa7d")),o={props:{title:String,book:Object,section:Object,currentSectionIndex:Number,currentSectionTotal:Number,isPlaying:Boolean,playInfo:Object},data:function(){return{visible:!1,speakCardVisible:!1,progress:0,readHeight:0}},methods:{refreshProgress:function(t){this.progress=t,this.$refs.progress.style.backgroundSize="".concat(this.progress,"% 100%")},updateText:function(t){var e=this;t.then((function(){var t=e.rendition.currentLocation(),i=e.section.cfiBase,n=t.start.cfi.replace(/.*!/,"").replace(/\)/,""),a=t.end.cfi.replace(/.*!/,"").replace(/\)/,"");e.book.getRange("epubcfi(".concat(i,"!,").concat(n,",").concat(a,")")).then((function(t){var i=t.toString();i=i.replace(/\s(2,)/g,""),i=i.replace(/\r/g,""),i=i.replace(/\n/g,""),i=i.replace(/\t/g,""),i=i.replace(/\f/g,""),e.$emit("updateText",i)}))}))},togglePlay:function(){this.$parent.togglePlay()},prev:function(){var t=this;this.currentSectionIndex>1&&(this.updateText(this.rendition.prev()),this.$emit("update:currentSectionIndex",this.currentSectionIndex-1),this.$parent.resetPlay(),setTimeout((function(){t.$parent.togglePlay()}),500))},next:function(){var t=this;this.currentSectionIndex<this.currentSectionTotal&&(this.updateText(this.rendition.next()),this.$emit("update:currentSectionIndex",this.currentSectionIndex+1),this.$parent.resetPlay(),setTimeout((function(){t.$parent.togglePlay()}),500))},display:function(){this.rendition||(this.rendition=this.book.renderTo("book-read",{width:window.innerWidth>640?640:window.innerWidth,height:this.readHeight,method:"default"})),this.displayed=this.rendition.display(this.section.href)},onProgressChange:function(t){},onProgressInput:function(t){this.progress=t,this.$refs.progress.style.backgroundSize="".concat(this.progress,"% 100%")},hide:function(){this.speakCardVisible=!1,this.visible=!1},show:function(){var t=this;this.visible=!0,this.speakCardVisible=!0,this.refresh(),this.$nextTick((function(){t.display()}))},refresh:function(){this.readHeight=.9*window.innerHeight-Object(s["b"])(40)-Object(s["b"])(54)-Object(s["b"])(46)-Object(s["b"])(48)-Object(s["b"])(60)-Object(s["b"])(44),this.$refs.bookWrapper.style.height=this.readHeight+"px"}}},r=o,c=(i("2d27"),i("2877")),l=Object(c["a"])(r,n,a,!1,null,"90471c68",null);e["a"]=l.exports},"76d3":function(t,e,i){},"9fa9":function(t,e,i){"use strict";(function(t){i("a4d3"),i("e01a"),i("99af"),i("4de4"),i("4160"),i("ac1f"),i("5319"),i("159b");var n=i("1432"),a=i("c470"),s=i("6701"),o=i("c4f7"),r=i("3111"),c=i("5b70"),l=i("da6f"),u=i("73f5"),p=i("101f"),d=i("fa7d"),h=i("a211");t.ePub=h["a"],e["a"]={components:{DetailTitle:n["a"],BookInfo:a["a"],Scroll:s["a"],SpeakPlaying:o["a"],Bottom:r["a"],SpeakWindow:c["a"]},computed:{currentMinute:function(){var t=Math.floor(this.currentPlayingTime/60);return t<10?"0"+t:t},currentSecond:function(){var t=Math.floor(this.currentPlayingTime-60*parseInt(this.currentMinute));return t<10?"0"+t:t},totalMinute:function(){var t=Math.floor(this.totalPlayingTime/60);return t<10?"0"+t:t},totalSecond:function(){var t=Math.floor(this.totalPlayingTime-60*parseInt(this.totalMinute));return t<10?"0"+t:t},leftMinute:function(){var t=Math.floor((this.totalPlayingTime-this.currentPlayingTime)/60);return t<10?"0"+t:t},leftSecond:function(){var t=Math.floor(this.totalPlayingTime-this.currentPlayingTime-60*parseInt(this.leftMinute));return t<10?"0"+t:t},playInfo:function(){return this.audioCanPlay?{currentMinute:this.currentMinute,currentSecond:this.currentSecond,totalMinute:this.totalMinute,totalSecond:this.totalSecond,leftMinute:this.leftMinute,leftSecond:this.leftSecond}:null},lang:function(){return this.metadata?this.metadata.language:""},disableScroll:function(){return!!this.$refs.speakWindow&&this.$refs.speakWindow.visible},showPlay:function(){return this.playingIndex>=0},scrollBottom:function(){return this.showPlay?116:52},chapter:function(){return this.flatNavigation[this.playingIndex]},desc:function(){return this.description?this.description.substring(0,100):""},flatNavigation:function(){return this.navigation?Array.prototype.concat.apply([],Array.prototype.concat.apply([],this.doFlatNavigation(this.navigation.toc))):[]},category:function(){return this.bookItem?Object(l["g"])(this.bookItem.category):""},title:function(){return this.metadata?this.metadata.title:""},author:function(){return this.metadata?this.metadata.creator:""}},data:function(){return{bookItem:null,book:null,rendition:null,metadata:null,cover:null,navigation:null,description:null,ifShowContent:!0,playingIndex:-1,paragraph:null,currentSectionIndex:null,currentSectionTotal:null,section:null,isPlaying:!1,audio:null,audioCanPlay:!1,currentPlayingTime:0,totalPlayingTime:0,playStatus:0,toastText:"",isOnline:!1}},methods:{createVoice:function(t){var e=new XMLHttpRequest;e.open("GET","".concat("https://junliwrotethis.github.io/vue-ebook","/voice?text=").concat(t,"&lang=").concat(this.lang.toLowerCase()),!1),e.send();var i=e.responseText;if(i){var n=JSON.parse(i);n.path?(this.$refs.audio.src=n.path,this.continuePlay()):this.showToast("播放失败，未生成链接")}else this.showToast("播放失败")},togglePlay:function(){this.isPlaying?this.pausePlay():0===this.playStatus?this.play():2===this.playStatus&&this.continuePlay()},speak:function(t,e){var i=this;this.resetPlay(),this.playingIndex=e,this.$nextTick((function(){i.$refs.scroll.refresh()})),this.chapter&&(this.section=this.book.spine.get(this.chapter.href),this.rendition.display(this.section.href).then((function(t){var e=i.rendition.currentLocation(),n=t.cfiBase,a=e.start.cfi.replace(/.*!/,"").replace(/\)/,""),s=e.end.cfi.replace(/.*!/,"").replace(/\)/,"");i.currentSectionIndex=e.start.displayed.page,i.currentSectionTotal=e.start.displayed.total;var o="epubcfi(".concat(n,"!,").concat(a,",").concat(s,")");i.book.getRange(o).then((function(t){var e=t.toLocaleString();e=e.replace(/\s(2,)/g,""),e=e.replace(/\r/g,""),e=e.replace(/\n/g,""),e=e.replace(/\t/g,""),e=e.replace(/\f/g,""),i.updateText(e)}))})))},resetPlay:function(){1===this.playStatus&&this.pausePlay(),this.isPlaying=!1,this.playStatus=0},play:function(){this.createVoice(this.paragraph)},continuePlay:function(){var t=this;this.$refs.audio.play().then((function(){t.$refs.speakPlaying[0].startAnimation(),t.isPlaying=!0,t.playStatus=1}))},pausePlay:function(){this.$refs.audio.pause(),this.$refs.speakPlaying[0].stopAnimation(),this.isPlaying=!1,this.playStatus=2},onAudioEnded:function(){this.resetPlay(),this.currentPlayingTime=this.$refs.audio.currentTime;var t=Math.floor(this.currentPlayingTime/this.totalPlayingTime*100);this.$refs.speakWindow.refreshProgress(t)},onTimeUpdate:function(){this.currentPlayingTime=this.$refs.audio.currentTime;var t=Math.floor(this.currentPlayingTime/this.totalPlayingTime*100);this.$refs.speakWindow.refreshProgress(t)},onCanPlay:function(){this.audioCanPlay=!0,this.currentPlayingTime=this.$refs.audio.currentTime,this.totalPlayingTime=this.$refs.audio.duration},findBookFromList:function(t){var e=this;Object(u["c"])().then((function(i){if(200===i.status){var n=i.data.data.filter((function(e){return e.fileName===t}));n&&n.length>0&&(e.bookItem=n[0],e.init())}}))},init:function(){var t=this,e=this.$route.query.fileName;this.bookItem||(this.bookItem=Object(l["e"])(e)),this.bookItem?Object(p["b"])(e,(function(e,i){if(e||!i){t.isOnline=!0;var n=t.$route.query.opf;n&&t.parseBook(n)}else t.isOnline=!1,t.parseBook(i)})):this.findBookFromList(e)},downloadBook:function(t){var e=this;Object(u["b"])(this.bookItem,(function(){Object(p["b"])(t,(function(t,i){t||e.parseBook(i)}))}))},parseBook:function(t){var e=this;this.book=new h["a"](t),this.book.loaded.metadata.then((function(t){e.metadata=t})),this.isOnline?this.book.coverUrl().then((function(t){e.cover=t})):this.book.loaded.cover.then((function(t){e.book.archive.createUrl(t).then((function(t){e.cover=t}))})),this.book.loaded.navigation.then((function(t){e.navigation=t})),this.display()},back:function(){this.$router.go(-1)},onScroll:function(t){t>Object(d["b"])(42)?this.$refs.title.showShadow():this.$refs.title.hideShadow()},toggleContent:function(){this.ifShowContent=!this.ifShowContent},display:function(){var t=.9*window.innerHeight-Object(d["b"])(40)-Object(d["b"])(54)-Object(d["b"])(46)-Object(d["b"])(48)-Object(d["b"])(60)-Object(d["b"])(44);this.rendition=this.book.renderTo("read",{width:window.innerWidth,height:t,method:"default"}),this.rendition.display()},doFlatNavigation:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[];return t.forEach((function(t){t.deep=i,n.push(t),t.subitems&&t.subitems.length>0&&n.push(e.doFlatNavigation(t.subitems,i+1))})),n},showToast:function(t){this.simpleToast(t)},onPlayingCardClick:function(){this.$refs.speakWindow.show()},updateText:function(t){this.paragraph=t}},mounted:function(){this.init()}}}).call(this,i("c8ba"))},bd2a:function(t,e,i){"use strict";var n=i("4d646"),a=i.n(n);a.a},c4f7:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"playing-item-wrapper"},t._l(t.styles,(function(t,e){return i("div",{key:e,ref:"playingItem",refInFor:!0,staticClass:"playing-item",style:t})})),0)},a=[],s=(i("4160"),i("a9e3"),i("159b"),i("fa7d")),o={props:{number:Number},computed:{styles:function(){for(var t=new Array(this.number),e=0;e<t.length;e++)t[e]={height:Object(s["a"])(this.random())+"rem"};return t}},methods:{startAnimation:function(){var t=this;this.task=setInterval((function(){t.$refs.playingItem.forEach((function(e){e.style.height=Object(s["a"])(t.random())+"rem"}))}),200)},stopAnimation:function(){this.task&&clearInterval(this.task)},random:function(){return Math.ceil(10*Math.random())}}},r=o,c=(i("bd2a"),i("2877")),l=Object(c["a"])(r,n,a,!1,null,"0f3d8204",null);e["a"]=l.exports},db59:function(t,e,i){"use strict";var n=i("5076"),a=i.n(n);a.a},f609:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"book-speaking"},[i("detail-title",{ref:"title",on:{back:t.back}}),i("scroll",{ref:"scroll",staticClass:"content-wrapper",attrs:{top:42,bottom:t.scrollBottom,ifNoScroll:t.disableScroll},on:{onScroll:t.onScroll}},[i("book-info",{attrs:{cover:t.cover,title:t.title,author:t.author,desc:t.desc}}),i("div",{staticClass:"book-speak-title-wrapper"},[i("div",{staticClass:"icon-speak-wrapper"},[i("span",{staticClass:"icon-speak"})]),i("div",{staticClass:"speak-title-wrapper"},[i("span",{staticClass:"speak-title"},[t._v(t._s(t.$t("speak.voice")))])]),i("div",{staticClass:"icon-down-wrapper",on:{click:t.toggleContent}},[i("span",{class:{"icon-down2":!t.ifShowContent,"icon-up":t.ifShowContent}})])]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.ifShowContent,expression:"ifShowContent"}],staticClass:"book-detail-content-wrapper"},[i("div",{staticClass:"book-detail-content-list-wrapper"},[this.navigation?t._e():i("div",{staticClass:"loading-text-wrapper"},[i("span",{staticClass:"loading-text"},[t._v(t._s(t.$t("detail.loading")))])]),i("div",{staticClass:"book-detail-content-item-wrapper"},t._l(t.flatNavigation,(function(e,n){return i("div",{key:n,staticClass:"book-detail-content-item",on:{click:function(i){return t.speak(e,n)}}},[t.playingIndex===n?i("speak-playing",{ref:"speakPlaying",refInFor:!0,attrs:{number:5}}):t._e(),e.label?i("div",{staticClass:"book-detail-content-navigation-text",class:{"is-playing":t.playingIndex===n}},[t._v(t._s(e.label)+" ")]):t._e()],1)})),0)])]),i("audio",{ref:"audio",on:{canplay:t.onCanPlay,timeupdate:t.onTimeUpdate,ended:t.onAudioEnded}})],1),i("bottom",{attrs:{chapter:t.chapter,currentSectionIndex:t.currentSectionIndex,currentSectionTotal:t.currentSectionTotal,showPlay:t.showPlay,isPlaying:t.isPlaying,playInfo:t.playInfo},on:{"update:isPlaying":function(e){t.isPlaying=e},"update:is-playing":function(e){t.isPlaying=e},onPlayingCardClick:t.onPlayingCardClick}}),t._m(0),i("speak-window",{ref:"speakWindow",attrs:{title:this.chapter?this.chapter.label:"",book:t.book,section:t.section,currentSectionIndex:t.currentSectionIndex,currentSectionTotal:t.currentSectionTotal,isPlaying:t.isPlaying,playInfo:t.playInfo},on:{"update:currentSectionIndex":function(e){t.currentSectionIndex=e},"update:current-section-index":function(e){t.currentSectionIndex=e},"update:isPlaying":function(e){t.isPlaying=e},"update:is-playing":function(e){t.isPlaying=e},updateText:t.updateText}})],1)},a=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"book-wrapper"},[i("div",{attrs:{id:"read"}})])}],s=i("9fa9"),o=s["a"],r=(i("36ff"),i("2877")),c=Object(r["a"])(o,n,a,!1,null,"0032f20a",null);e["default"]=c.exports}}]);
//# sourceMappingURL=chunk-f0190fe4.c85477e9.js.map